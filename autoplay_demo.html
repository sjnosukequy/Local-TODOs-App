<!DOCTYPE html>
<html>

<head>
    <!-- <script type="text/javascript" id="www-widgetapi-script"
        src="https://www.youtube.com/s/player/bd3293c9/www-widgetapi.vflset/www-widgetapi.js" async=""></script> -->
    <!-- <script src="https://www.youtube.com/iframe_api"></script> -->
</head>

<body>
    <input id="txt" value="https://www.youtube.com/watch?v=Kpg-OVlruxU&list=RDKpg-OVlruxU&start_radio=1">
    <button id='play_current'>play now</button>
    <button id='add_playlist'>add to playlist</button>
    <br>
    <p id="tile" style="width: 420px;"></p>
    <div id="contaier"></div>
    <div style="width: 420px; display: flex; gap: 10px; margin-top: 10px;">
        <button id="play" style="display: none;">play</button>
        <button id="pause" style="display: none;">pause</button>
        <button id="next" style="display: none;">next</button>
        <button id="prev" style="display: none;">previous</button>
        <button id="thumb" hide="false" style="display: none;">Show/Hide</button>
    </div>
    <p id="playlist_len"></p>
    <script>
        // 2. This code loads the IFrame Player API code asynchronously.
        let song_list = []
        let song_idx = 0
        var tag = document.createElement('script');
        let body = document.querySelector('#contaier')

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerStateChange(event) {
            document.getElementById('tile').innerText = event.target.videoTitle
            document.getElementById('playlist_len').innerText = song_list.length.toString() + ' in the playlist'
            if (event.data == 0)
                if (song_idx + 1 < song_list.length) {
                    song_idx += 1
                    player.loadVideoById(`${song_list[song_idx]}`)
                }
        }

        function onPlayerReady(event) {
            // document.getElementById('tile').innerText = player.videoTitle
            document.getElementById('play').style.display = 'block'
            document.getElementById('pause').style.display = 'block'
            document.getElementById('next').style.display = 'block'
            document.getElementById('prev').style.display = 'block'
            document.getElementById('thumb').style.display = 'block'

            document.getElementById('play').addEventListener('click', () => {
                player.playVideo()
            })

            document.getElementById('pause').addEventListener('click', () => {
                player.pauseVideo()
            })

            document.getElementById('thumb').addEventListener('click', () => {
                let hide_bool = document.getElementById('thumb').getAttribute('hide')
                if (hide_bool.toLocaleLowerCase() === 'true') {
                    document.getElementById('thumb').setAttribute('hide', 'false')
                    document.getElementById('player').style.display = 'block'
                    // let img = body.querySelector('img')
                    // body.removeChild(img)
                }
                else {
                    document.getElementById('thumb').setAttribute('hide', 'true')
                    document.getElementById('player').style.display = 'none'
                    // let img = document.createElement('img')
                    // img.setAttribute('src', `https://img.youtube.com/vi/${song_list[song_idx]}/mqdefault.jpg`)
                    // img.setAttribute('width', '420px')
                    // body.appendChild(img)
                }
            })

            document.getElementById('next').addEventListener('click', () => {
                if (song_idx + 1 < song_list.length) {
                    song_idx += 1
                    player.loadVideoById(`${song_list[song_idx]}`)
                }
            })

            document.getElementById('prev').addEventListener('click', () => {
                if (song_idx - 1 >= 0) {
                    song_idx -= 1
                    player.loadVideoById(`${song_list[song_idx]}`)
                }
            })

        }

        document.getElementById('play_current').addEventListener('click', () => {
            let b = document.getElementById('txt')
            if (b.value.includes('www.youtube.com/watch?v=')) {

                let c = b.value.split('?v=')
                if (c[1].includes('&')) {
                    c = c[1].split('&')[0]
                }
                else {
                    c = c[1]
                }

                let body = document.querySelector('#contaier')
                // console.log(body.children)
                if (body.children.length == 0) {
                    let a = document.createElement('iframe')
                    a.setAttribute('id', 'player')
                    a.setAttribute('src', `https://www.youtube.com/embed/${c}?autoplay=1&enablejsapi=1`)
                    a.setAttribute('width', '420')
                    a.setAttribute('height', '345')
                    // a.style.display = 'none'
                    body.appendChild(a)
                    onYouTubeIframeAPIReady()
                    song_list.push(c)
                }
                else {
                    player.loadVideoById(`${c}`)
                    song_list = []
                    song_list.push(c)
                    song_idx = 0
                }
            }
        })

        document.getElementById('add_playlist').addEventListener('click', () => {
            let b = document.getElementById('txt')
            if (b.value.includes('www.youtube.com/watch?v=')) {

                let c = b.value.split('?v=')
                if (c[1].includes('&')) {
                    c = c[1].split('&')[0]
                }
                else {
                    c = c[1]
                }

                let body = document.querySelector('#contaier')
                // console.log(body.children)
                if (body.children.length == 0) {
                    let a = document.createElement('iframe')
                    a.setAttribute('id', 'player')
                    a.setAttribute('src', `https://www.youtube.com/embed/${c}?autoplay=1&enablejsapi=1`)
                    a.setAttribute('width', '420')
                    a.setAttribute('height', '345')
                    // a.style.display = 'none'
                    body.appendChild(a)
                    onYouTubeIframeAPIReady()
                    song_list.push(c)
                }
                else {
                    song_list.push(c)
                    document.getElementById('playlist_len').innerText = song_list.length.toString() + ' in the playlist'
                }

            }
        })

    </script>
</body>

</html>